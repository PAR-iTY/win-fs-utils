"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.join.js"),require("core-js/modules/es.object.define-property.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.promptHandle=exports.pipeHandle=exports.init=exports.getFiles=void 0,require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.map.js");var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_isMainESM=_interopRequireDefault(require("./isMainESM.js")),_utils=require("./utils.js"),_pipe=require("./pipe.js"),_ID3Tags=require("./ID3-tags.js"),_minimist=_interopRequireDefault(require("minimist")),_prompts=_interopRequireDefault(require("prompts")),_glob=_interopRequireDefault(require("glob")),_path2=require("path");console.time("import load time"),console.timeEnd("import load time");var init=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,argsHandle();case 2:b=a.sent,c=getFiles(b.path,b.ext,b.recurse),console.log("files:",c),c.length&&".mp3"===b.ext&&(console.log("extension is mp3"),b.tagType&&b.tagReplace&&(console.log("passing to ID3-tags.."),(0,_ID3Tags.tweakTags)(c,b.tagType,b.tagFind||void 0,b.tagReplace)));case 6:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();exports.init=init;var argsHandle=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,c,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b={ext:""},c=(0,_minimist["default"])(process.argv.slice(2),{default:b}),console.log("minimist args:",c),c.hasOwnProperty("ext")&&c.ext&&!0!==c.ext?(console.log("ext detected:",c.ext),"."!==c.ext[0]&&(c.ext="."+c.ext)):c.hasOwnProperty("path")&&(0,_path2.extname)(c.path)?c.ext=(0,_path2.extname)(c.path):console.log("ext error",c.ext),c.ext=c.ext.toLowerCase(),c.recurse=c.hasOwnProperty("recurse")&&!0===c.recurse?"/":"",c.hasOwnProperty("path")){a.next=22;break}return console.log("cmd did not include '--path'"),console.log("trying cwd.."),a.next=11,pipeHandle(process.cwd(),_pipe.cleanCwdSyncPipe);case 11:if(d=a.sent,d){a.next=19;break}return console.error("[cwd error]",d),console.log("calling prompt.."),a.next=17,promptHandle();case 17:return c.path=a.sent,a.abrupt("return",c);case 19:return console.log("no --path and cwd is a safe default search location:",d),c.path=d,a.abrupt("return",c);case 22:if(c.path&&!0!==c.path){a.next=29;break}return console.error("[--path is falsy or empty]",c.path),console.log("calling prompt.."),a.next=27,promptHandle();case 27:return c.path=a.sent,a.abrupt("return",c);case 29:return a.next=31,pipeHandle(c.path,_pipe.cleanPathAsyncPipe);case 31:if(c.path=a.sent,c.path){a.next=39;break}return console.error("[path handle error]",c.path),console.log("calling prompt.."),a.next=37,promptHandle();case 37:return c.path=a.sent,a.abrupt("return",c);case 39:return a.abrupt("return",c);case 40:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),pipeHandle=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,c(b);case 3:b=a.sent,a.next=10;break;case 6:return a.prev=6,a.t0=a["catch"](0),console.error("[pipe error]",a.t0),a.abrupt("return",!1);case 10:if(!b){a.next=12;break}return a.abrupt("return",b);case 12:case"end":return a.stop();}},a,null,[[0,6]])}));return function(){return a.apply(this,arguments)}}();exports.pipeHandle=pipeHandle;var promptHandle=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){var c,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,_prompts["default"])({type:"text",name:"path",message:b||"Please enter a path to search or press enter to default to current directory",validate:function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,pipeHandle(b,_pipe.cleanPathAsyncPipe);case 2:if(a.sent){a.next=6;break}a.t0="\u274C Path is forbidden, please try again",a.next=7;break;case 6:a.t0=!0;case 7:return a.abrupt("return",a.t0);case 8:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}()});case 2:if(c=a.sent,""!==c.path&&"."!==c.path&&"./"!==c.path){a.next=8;break}return a.next=6,pipeHandle(process.cwd(),_pipe.cleanCwdSyncPipe);case 6:d=a.sent,c.path=!!d&&d;case 8:return a.abrupt("return",c.path);case 9:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();exports.promptHandle=promptHandle;var getFiles=function(a,b,c){var d={ignore:["**/*NTUSER*","**/*ntuser*","**/*.DAT","**/*.dat","**/*.SYS","**/*.sys","**/*msdownld.tmp","**/*Recovery.txt","**/AppData/**","**/Application Data/**","**/$AVG/**","**/$RECYCLE.BIN/**","**/$Recycle.Bin/**","**/System Volume Information/**","**/Windows/**","**/Application Data/**","**/Local Settings/**","**/ProgramData/**","**/Program Files/**","**/Program Files (x86)/**","**/Recovery/**","**/PerfLogs/**","**/Documents and Settings/**","**/node_modules/**","F:/Utility/**","F:/UMIT/OS/**","C:/*Config*"],strict:!1,silent:!0,nodir:!!b,nocase:!0,statCache:!0},e=(0,_path2.parse)(a).root,f=a.slice(Math.max(e.length-1,0)),g="**/*";"/"===a&&(console.log("c root-level search detected.."),c?(console.log("..recurse detected --> editing _path.."),a=""):(console.log("..recurse not detected --> editing pattern.."),g="*")),"/"!==e[0]&&(console.log("non-c letter drive detected.."),"/"===f&&(console.log("..root-level search detected"),f="",!c&&(console.log("..recurse not detected"),g="/*")),d.cwd=e,a=f,console.log("set '".concat(e,"' as cwd and '").concat(f,"' as path"))),(0,_utils.isFile)((0,_path2.join)(e,f))&&(console.log("file-path detected"),c="",g="",b="",a=(0,_path2.join)(e,f),console.log("file-path:",a)),console.log("new glob-string: '".concat(a).concat(c).concat(g).concat(b,"'")),console.time("search execution time");try{var h=_glob["default"].sync("".concat(a).concat(c).concat(g).concat(b),d);return console.timeEnd("search execution time"),h.length?h.map(function(a){return(0,_pipe.cleanGlobSyncPipe)(a)}):(console.log("no files found",h),!1)}catch(a){return console.error("glob error:",a),!1}};exports.getFiles=getFiles,(0,_isMainESM["default"])(import.meta.url)&&("win32"===process.platform?(console.time("init() execution time"),init(),console.timeEnd("init() execution time")):console.error("[platform is not win32] platform:",process.platform));