"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.object.define-property.js");Object.defineProperty(exports,"__esModule",{value:!0}),exports.syncPipe=exports.sleep=exports.realPath=exports.posixPath=exports.log=exports.cleanSysRoot=exports.cleanPathAsyncPipe=exports.cleanGlobSyncPipe=exports.cleanFileURL=exports.cleanCwdSyncPipe=exports.cleanBashRoot=exports.asyncPipe=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));require("core-js/modules/es.array.join.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.string.starts-with.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.string.replace.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/web.timers.js");var _url=require("url"),_path2=require("path"),_fs=require("fs"),_utils=require("./utils.js"),realPath=function(a){return(0,_fs.realpathSync)(a)};exports.realPath=realPath;var posixPath=function(a){return a.split(_path2.sep).join(_path2.posix.sep)};exports.posixPath=posixPath;var cleanFileURL=function(a){return a.toLowerCase().startsWith("file:")?(console.log("path is a file URL, cleaning.."),(0,_url.fileURLToPath)(a)):a};exports.cleanFileURL=cleanFileURL;var cleanSysRoot=function(a){if((0,_utils.isLetter)(a[0])&&"c"!==a[0].toLowerCase())return a;var b=0;switch((0,_path2.parse)(a).root.toLowerCase()){case"/":return a;case"c:/":b=3;break;case"c:\\":b=3;break;case"c:\\\\":b=4;break;case"//":console.log("unexpected '//' root!"),b=2;break;case"\\":console.log("unexpected '\\' root!"),b=1;break;case"\\\\":console.log("unexpected '\\\\' root!"),b=2;break;case"":console.error("[pipe.js] empty path detected:",a);break;default:console.error("[path root switch statement error] path root: '".concat((0,_path2.parse)(a).root,"'"));}return b&&(a=(0,_path2.join)("/",(0,_path2.parse)(a).dir.slice(b),(0,_path2.parse)(a).base)),a};exports.cleanSysRoot=cleanSysRoot;var cleanBashRoot=function(a){return a.startsWith("C:/Program Files/Git")?a.replace("C:/Program Files/Git",""):a};exports.cleanBashRoot=cleanBashRoot;var syncPipe=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a){return b.reduce(function(a,b){return b(a)},a)}};exports.syncPipe=syncPipe;var asyncPipe=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a){return b.reduce(function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b,c){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=c,a.next=3,b;case 3:return a.t1=a.sent,a.abrupt("return",(0,a.t0)(a.t1));case 5:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),a)}};exports.asyncPipe=asyncPipe;var sleep=function(a){return new Promise(function(b){setTimeout(function(){return b(a+"/sleep/")},2e3)})};exports.sleep=sleep;var log=function(a){return console.log("pipe-log:",a),a};exports.log=log;var cleanGlobSyncPipe=syncPipe(cleanSysRoot,posixPath);exports.cleanGlobSyncPipe=cleanGlobSyncPipe;var cleanCwdSyncPipe=syncPipe(cleanBashRoot,cleanGlobSyncPipe);exports.cleanCwdSyncPipe=cleanCwdSyncPipe;var cleanPathAsyncPipe=asyncPipe(cleanBashRoot,cleanFileURL,realPath,cleanGlobSyncPipe);exports.cleanPathAsyncPipe=cleanPathAsyncPipe;